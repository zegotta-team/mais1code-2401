<?php FlashMessage::getMessage() ?>

<form action="/empresa/processaCadastrar" method="post">
    <div class="row mt-3">
        <div class="col-6 col-md-6">
            <div class="p-3 p-md-4 p-xl-5">
                <div class="row gy-3 gy-md-4 overflow-hidden">
                    <h6>Dados da empresa</h6>
                    <div class="col-6">
                        <label for="cnpj" class="form-label">CNPJ
                            <span>*</span></label>
                        <input type="text" class="form-control" name="cnpj" id="cnpj" placeholder="CNPJ" maxlength="14" minlength="14" required>
                    </div>
                    <div class="col-12">
                        <label for="nome" class="form-label">Nome da empresa
                            <span>*</span></label>
                        <input type="text" class="form-control" name="nome" id="nome" placeholder="Nome da empresa" required>
                    </div>
                    <div class="col-12">
                        <label for="email" class="form-label">Email
                            <span>*</span></label>
                        <input type="email" class="form-control" name="email" id="email" placeholder="Informe um email válido" required>
                    </div>
                    <div class="col-12">
                        <label for="descricao" class="form-label">Descrição
                            <span>*</span></label>
                        <textarea type="text" class="form-control" name="descricao" id="descricao" placeholder="Descrição" required></textarea>
                    </div>
                    <div class="col-12">
                        <label for="logo" class="form-label">Logo
                            <span>*</span></label>
                        <input type="text" class="form-control" name="logo" id="logo" placeholder="Adicione uma imagem" required>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-6 col-md-6 border-start border-secondary">
            <div class="p-3 p-md-4 p-xl-5">
                <div class="row gy-3 gy-md-4 overflow-hidden">
                    <h6>Dados do usuário</h6>
                    <div class="col-6">
                        <label for="usuarioCpf" class="form-label">CPF
                            <span>*</span></label>
                        <input type="text" class="form-control" name="usuarioCpf" id="usuarioCpf" placeholder="Informe o CPF do usuário" required>
                    </div>
                    <div class="col-6">
                        <label for="usuarioSenha" class="form-label">Senha
                            <span>*</span></label>
                        <input type="password" class="form-control" name="usuarioSenha" id="usuarioSenha" value="" required placeholder="*****">
                    </div>
                    <div class="col-12">
                        <label for="usuarioNome" class="form-label">Nome
                            <span>*</span></label>
                        <input type="text" class="form-control" name="usuarioNome" id="usuarioNome" placeholder="Informe o nome do usuário" required>
                    </div>
                    <div class="col-12">
                        <label for="usuarioEmail" class="form-label">Email
                            <span>*</span></label>
                        <input type="text" class="form-control" name="usuarioEmail" id="usuarioEmail" placeholder="Informe o e-mail do usuário" required>
                    </div>
                </div>
                <hr>
                <div class="row gy-3 gy-md-4 overflow-hidden">
                    <h6>Dados da filial</h6>
                    <div class="col-8">
                        <label for="filialNome" class="form-label">Nome da filial *</label>
                        <input type="text" class="form-control" name="filialNome" id="filialNome" required>
                    </div>
                    <div class="col-4">
                        <label for="filialCep" class="form-label">Cep *</label>
                        <input type="text" class="form-control" name="filialCep" id="filialCep" minlength="8" maxlength="8" required oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                    </div>
                    <div class="col-12">
                        <label for="filialLogradouro" class="form-label">Logradouro *</label>
                        <input type="text" class="form-control" name="filialLogradouro" id="filialLogradouro">
                    </div>
                    <div class="col-4">
                        <label for="filialNumero" class="form-label">Numero *</label>
                        <input type="text" class="form-control" name="filialNumero" id="filialNumero">
                    </div>
                    <div class="col-8">
                        <label for="filialComplemento" class="form-label">Complemento *</label>
                        <input type="text" class="form-control" name="filialComplemento" id="filialComplemento">
                    </div>
                    <div class="col-5">
                        <label for="filialBairro" class="form-label">Bairro *</label>
                        <input type="text" class="form-control" name="filialBairro" id="filialBairro">
                    </div>
                    <div class="col-5">
                        <label for="filialCidade" class="form-label">Cidade *</label>
                        <input type="text" class="form-control" name="filialCidade" id="filialCidade" required>
                    </div>
                    <div class="col-2">
                        <label for="filialEstado" class="form-label">Estado</label>
                        <select class="form-control" name="filialEstado" id="filialEstado" required>
                            <option value="" disabled selected>-</option>
                                <?php foreach (FilialEstadoEnum::forSelect() as $indice => $valor): ?>
                                    <option value="<?= $indice ?>" <?= !empty($filial) && $filial->getEstado() == $indice ? 'selected' : ''?>><?= $valor ?></option>
                                <?php endforeach; ?>
                        </select>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-grid">
                <button class="btn btn-primary" type="submit">Cadastrar</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <hr class="mt-5 mb-4 border-secondary-subtle">
            <div class="d-flex gap-2 gap-md-4 flex-column flex-md-row justify-content-between">
                <a href="/" class="link-secondary text-decoration-none">Painel de vagas</a>
                <a href="/autenticacao/index" class="link-secondary text-decoration-none">Já possui cadastro? Faça o login</a>
            </div>
        </div>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        let campo = document.querySelector("#filialCep");

        campo.addEventListener('blur', function () {
            // let url = 'https://brasilapi.com.br/api/cep/v1/' + campo.value;
            let url = '/api/cep/?cep=' + campo.value;
            fetch(url)
                .then(response => {
                    if (response.status !== 200) {
                        throw new Error('Erro lalallaa')
                    }
                    return response.json()
                })
                .then(data => {
                    document.querySelector("#filialLogradouro").value = data.street;
                    document.querySelector("#filialBairro").value = data.neighborhood;
                    document.querySelector("#filialCidade").value = data.city;
                    document.querySelector("#filialEstado").value = data.state;

                })
                .catch(error => {
                    alert('CEP não encontrado');
                    campo.value = '';
                    document.querySelector("#filialLogradouro").value = '';
                    document.querySelector("#filialBairro").value = '';
                    document.querySelector("#filialCidade").value = '';
                    document.querySelector("#filialEstado").value = '';
                })
        });

        let campoCnpj = document.querySelector("#cnpj")

        campoCnpj.addEventListener('blur', function () {
            // let url = 'https://brasilapi.com.br/api/cnpj/v1/' + campoCnpj.value
            let url = '/api/cnpj/?cnpj=' + campoCnpj.value;
            fetch(url)
                .then(response => {
                    if (response.status !== 200) {
                        throw new Error('')
                    }
                    return response.json()
                })
                .then(data => {
                    document.querySelector('#nome').value = data.nome_fantasia
                    document.querySelector('#filialNome').value = data.nome_fantasia + ' - Matriz'
                })
                .catch(error => {
                    document.querySelector('#nome').value = ''
                    document.querySelector('#filialNome').value = 'Matriz'
                })
        })


    });
</script>
